name: Global Detection Solutions Changed

on:
  workflow_call:
    inputs:
      base_sha:
        description: "Base commit SHA (optional). If empty, inferred from event."
        required: false
        type: string
      head_sha:
        description: "Head commit SHA (optional). If empty, inferred from event."
        required: false
        type: string
    outputs:
      solutions:
        description: "JSON array of discovered modified solutions with metadata."
        value: ${{ jobs.detect_services.outputs.solutions }}
      paths:
        description: "JSON array of modified solution paths."
        value: ${{ jobs.detect_services.outputs.paths }}

jobs:
  detect_services:
    runs-on: ubuntu-latest
    outputs:
      solutions: ${{ steps.emit.outputs.solutions }}
      paths: ${{ steps.emit.outputs.paths }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Detect modified backend/frontend solutions
        id: emit
        env:
          INPUT_BASE_SHA: ${{ inputs.base_sha }}
          INPUT_HEAD_SHA: ${{ inputs.head_sha }}
        run: |
          set -euo pipefail
          python3 .github/scripts/detect_solutions_changed.py
